<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Yuimarl</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/style3.css">
    <link rel="icon" type="image/x-icon" href="static/favicon.ico">
  </head>
  <body>
    <main>
      <div class="container">
        <div class="row">
          <div class="col-md-1"></div>
          <div class="col col-md-10">
            <div class="row py-2">
              <div class="col-auto">
                <div class="logoImg"><a href="index.html"><img src="images/logo.gif" alt="Yuimarl"></a></div>
              </div>
            </div>
            <div class="row bg-dark px-2 px-md-0">
              <nav class="navbar navbar-expand-md navbar-dark sticky-top px-2">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbar-content">
                  <ul class="navbar-nav me-auto">
                    <li class="nav-item active"><a class="nav-link" href="index.html">ホーム</a></li>
                  </ul>
                </div>
              </nav>
            </div>
            <div class="row">
              <div class="col-md-9">
                <section class="pt-3">
                  <h2 class="pb-1">運用環境構築</h2>
                  <section>
                    <p>Yuimarlの運用環境は、以下の手順でセットアップを行います。</p>
                    <ol class="pb-2">
                      <li><a href="#step01">Firebase プロジェクトを作成する</a></li>
                      <li><a href="#step02">Cloud Run を設定する</a></li>
                    </ol>
                    <hr>
                    <section class="pb-2">
                      <h3 id="step01">Firebase プロジェクトを作成する</h3>
                      <p>Firebase コンソールで「プロジェクトを作成」をクリックします。<a href="images/screen04.png"><img class="border border-info border-1 img-fluid" src="images/screen04.png"></a></p>
                      <p>プロジェクトの名前を入力して「続行」をクリックします。<a href="images/screen05.png"><img class="border border-info border-1 img-fluid" src="images/screen05.png"></a></p>
                      <p>「続行」をクリックします。<a href="images/screen06.png"><img class="border border-info border-1 img-fluid" src="images/screen06.png"></a></p>
                      <p>「Firebaseを追加」をクリックします。<a href="images/screen07.png"><img class="border border-info border-1 img-fluid" src="images/screen07.png"></a></p>
                      <p>「続行」をクリックします。<a href="images/screen08.png"><img class="border border-info border-1 img-fluid" src="images/screen08.png"></a></p>
                      <p>Firebase プロジェクト画面の左側のメニューで「構築」をクリックして展開します。<a href="images/screen09.png"><img class="border border-info border-1 img-fluid" src="images/screen09.png"></a></p>
                      <p>「構築」の中の「Authentication」をクリックします。<a href="images/screen10.png"><img class="border border-info border-1 img-fluid" src="images/screen10.png"></a></p>
                      <p>「Authentication」の「始める」をクリックします。<a href="images/screen11.png"><img class="border border-info border-1 img-fluid" src="images/screen11.png"></a></p>
                      <p>「ログイン方法」の「メール / パスワード」をクリックします。<a href="images/screen12.png"><img class="border border-info border-1 img-fluid" src="images/screen12.png"></a></p>
                      <p>「メール / パスワード」を「有効にする」にして「保存」をクリックします。<a href="images/screen13.png"><img class="border border-info border-1 img-fluid" src="images/screen13.png"></a></p>
                      <p>「新しいプロバイダを追加」をクリックします。<a href="images/screen14.png"><img class="border border-info border-1 img-fluid" src="images/screen14.png"></a></p>
                      <p>「Google」をクリックします。<a href="images/screen15.png"><img class="border border-info border-1 img-fluid" src="images/screen15.png"></a></p>
                      <p>「Google」を「有効にする」にし、サポートメールを選択して「保存」をクリックします。<a href="images/screen16.png"><img class="border border-info border-1 img-fluid" src="images/screen16.png"></a><br>必要に応じて、他のプロバイダも追加してください。</p>
                      <p>本番環境として使う場合は、Authentication の「設定」の「承認済みドメイン」から、「localhost」を削除してください。<br>開発環境、テスト環境として使う場合は、「localhost」を残したままで大丈夫です。<a href="images/screen38.png"><img class="border border-info border-1 img-fluid" src="images/screen38.png"></a></p>
                      <p>「構築」の中の「Firestore Database」をクリックします。<a href="images/screen17.png"><img class="border border-info border-1 img-fluid" src="images/screen17.png"></a></p>
                      <p>「Cloud Firestore」の「データベースの作成」をクリックします。<a href="images/screen18.png"><img class="border border-info border-1 img-fluid" src="images/screen18.png"></a></p>
                      <p>ロケーションを選択して「次へ」をクリックします。<a href="images/screen19.png"><img class="border border-info border-1 img-fluid" src="images/screen19.png"></a></p>
                      <p>「テストモードで開始する」を選択して「作成」をクリックします。<a href="images/screen20.png"><img class="border border-info border-1 img-fluid" src="images/screen20.png"></a></p>
                      <p>「ルール」を画像のように編集して「公開」をクリックします。<a href="images/screen21.png"><img class="border border-info border-1 img-fluid" src="images/screen21.png"></a></p>
                      <p>「プロジェクトの設定」をクリックします。<a href="images/screen22.png"><img class="border border-info border-1 img-fluid" src="images/screen22.png"></a></p>
                      <p>「マイアプリ」にある「&lt;/&gt;」アイコンをクリックします。<a href="images/screen23.png"><img class="border border-info border-1 img-fluid" src="images/screen23.png"></a></p>
                      <p>「アプリのニックネーム」を入力して「アプリを登録」をクリックします。<a href="images/screen24.png"><img class="border border-info border-1 img-fluid" src="images/screen24.png"></a></p>
                      <p>「Firebase SDK の追加」で「&lt;script&gt;タグを使用する」を選択して「コンソールに進む」をクリックします。<br>（表示されたスクリプトの中の「firebaseConfig」の内容を保存しておいてください。）<a href="images/screen25.png"><img class="border border-info border-1 img-fluid" src="images/screen25.png"></a></p>
                    </section>
                    <hr>
                    <section class="pb-2">
                      <h3 id="step02">Cloud Run を設定する</h3>
                      <p>Google Cloud コンソールにログインして「プロジェクトの選択」をクリックします。<a href="images/screen26.png"><img class="border border-info border-1 img-fluid" src="images/screen26.png"></a></p>
                      <p>作成済みのプロジェクトを選択します。<a href="images/screen27.png"><img class="border border-info border-1 img-fluid" src="images/screen27.png"></a></p>
                      <p>「コンテナ化されたアプリの実行 Cloud Run」をクリックします。<a href="images/screen28.png"><img class="border border-info border-1 img-fluid" src="images/screen28.png"></a></p>
                      <p>「サービスを作成」をクリックします。<a href="images/screen29.png"><img class="border border-info border-1 img-fluid" src="images/screen29.png"></a></p>
                      <p>「課金を有効にして Cloud Run の使用を継続します」画面が表示された場合は、「[お支払い]に移動」をクリックして支払いの設定を行います。<a href="images/screen30.png"><img class="border border-info border-1 img-fluid" src="images/screen30.png"></a></p>
                      <p>「サービスを作成」で次の画像のように設定します。<br>（&nbsp;「コンテナイメージのURL」は、Docker Hub に登録されている最新のイメージを設定します）<a href="images/screen31.png"><img class="border border-info border-1 img-fluid" src="images/screen31.png"></a></p>
                      <p>「コンテナ、ボリューム、ネットワーキング、セキュリティ」の「コンテナ」の「変数とシークレット」に、「Firebase SDK の追加」で表示された firebaseConfig の値を追加して「作成」をクリックします。<a href="images/screen32.png"><img class="border border-info border-1 img-fluid" src="images/screen32.png"></a></p>
                      <p>
                        <table class="table table-bordered">
                          <tr>
                            <th>環境変数</th>
                            <th>設定する値</th>
                          </tr>
                          <tr>
                            <td>GOOGLE_PROJECT_ID</td>
                            <td>firebaseConfig の projectId</td>
                          </tr>
                          <tr>
                            <td>API_KEY</td>
                            <td>firebaseConfig の apiKey</td>
                          </tr>
                          <tr>
                            <td>AUTH_DOMAIN</td>
                            <td>firebaseConfig の authDomain</td>
                          </tr>
                          <tr>
                            <td>STORAGE_BUCKET</td>
                            <td>firebaseConfig の storageBucket</td>
                          </tr>
                          <tr>
                            <td>MESSAGING_SENDER_ID</td>
                            <td>firebaseConfig の messagingSenderId</td>
                          </tr>
                          <tr>
                            <td>APP_ID</td>
                            <td>firebaseConfig の appId</td>
                          </tr>
                          <tr>
                            <td>MEASUREMENT_ID</td>
                            <td>firebaseConfig の measurementId (これが無い場合は空欄)</td>
                          </tr>
                          <tr>
                            <td>RUST_LOG</td>
                            <td>「debug」または「info」。出力されるログをdebugレベルとするかinfoレベルとするかの設定。</td>
                          </tr>
                        </table>
                      </p>
                      <p>サービスがデプロイされたら、URL にアクセスします。<a href="images/screen33.png"><img class="border border-info border-1 img-fluid" src="images/screen33.png"></a></p>
                      <p>Yuimarl ログイン画面でログインします。<a href="images/screen34.png"><img class="border border-info border-1 img-fluid" src="images/screen34.png"></a></p>
                      <p>Yuimarl の操作中に、次のようなエラー画面が表示されることがあります。これは、データベースのインデックスが作成されていない場合のエラーです。<br>「You can create it here: 」の次に表示されている URL（画像で選択してある部分）にアクセスすると、インデックスの作成画面になるので、そこでインデックスを作成することができます。<a href="images/screen35.png"><img class="border border-info border-1 img-fluid" src="images/screen35.png"></a></p>
                      <p>次のような「インデックスの作成または更新」画面で「保存」をクリックするとインデックスが作成されます。<a href="images/screen36.png"><img class="border border-info border-1 img-fluid" src="images/screen36.png"></a></p>
                      <p>ステータスが「ビルド中...」から「有効」に変わったらインデックスが作成されました。<a href="images/screen37.png"><img class="border border-info border-1 img-fluid" src="images/screen37.png"></a></p>
                    </section>
                  </section>
                </section>
              </div>
              <div class="col-md-3">
                <div class="submenu mt-3">
                  <h3>CONTENTS</h3>
                  <ul>
                    <li><a href="https://mnitta220.github.io/">新田システム事務所</a></li>
                    <li><a href="index2.html">ホーム</a>
                      <ul>
                        <li><a href="devsetup.html">開発環境構築</a></li>
                        <li><a class="current" href="deploy.html">運用環境構築</a></li>
                        <li><a href="develop.html">開発情報</a></li>
                        <li><a href="howtouse.html">使い方</a></li>
                        <li><a href="agreement.html">利用規約</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="row bg-dark px-3">
              <footer class="py-1 text-light">
                <div class="container text-center">
                  <ul class="nav justify-content-center">
                    <li class="nav-item"><a class="nav-link" href="../privacy.html">プライバシー・ポリシー</a></li>
                  </ul>
                  <p style="color: #a0a0a0"><small>Copyright &copy; 2024 Masahiro Nitta. All Rights Reserved.</small></p>
                </div>
              </footer>
            </div>
          </div>
          <div class="col-md-1"></div>
        </div>
      </div>
    </main>
    <script src="js/bootstrap.bundle.min.js"></script>
  </body>
</html>